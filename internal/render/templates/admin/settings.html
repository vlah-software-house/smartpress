{{/* Copyright (c) 2026 Madalin Gabriel Ignisca <hi@madalin.me> */}}
{{/* Copyright (c) 2026 Vlah Software House SRL <contact@vlah.sh> */}}
{{/* All rights reserved. See LICENSE for details. */}}
{{define "title"}}Settings{{end}}

{{define "content"}}
<div class="space-y-6">
    <div>
        <h2 class="text-xl font-semibold text-gray-900">Settings</h2>
        <p class="mt-1 text-sm text-gray-500">Configure your YaaiCMS installation.</p>
    </div>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200 divide-y divide-gray-200">
        <!-- Site Settings -->
        <form method="POST" action="/admin/settings"
              hx-post="/admin/settings"
              hx-target="#main-content"
              class="p-6 space-y-6">
            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">

            <div>
                <h3 class="text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4">General</h3>
                <p class="text-sm text-gray-500 mb-4">Basic site identity and configuration.</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <!-- Site Title -->
                <div>
                    <label for="site_title" class="block text-sm font-medium text-gray-700 mb-1">Site Title</label>
                    <input type="text" id="site_title" name="site_title"
                           value="{{index .Data.Settings "site_title"}}"
                           class="block w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm
                                  focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none"
                           placeholder="My Website">
                    <p class="mt-1 text-xs text-gray-400">Displayed in the browser tab and site header.</p>
                </div>

                <!-- Site Tagline -->
                <div>
                    <label for="site_tagline" class="block text-sm font-medium text-gray-700 mb-1">Tagline</label>
                    <input type="text" id="site_tagline" name="site_tagline"
                           value="{{index .Data.Settings "site_tagline"}}"
                           class="block w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm
                                  focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none"
                           placeholder="Just another YaaiCMS site">
                    <p class="mt-1 text-xs text-gray-400">A short description or slogan for the site.</p>
                </div>

                <!-- Site URL (read-only for now) -->
                <div>
                    <label for="site_url" class="block text-sm font-medium text-gray-700 mb-1">Site URL</label>
                    <input type="url" id="site_url" name="site_url"
                           value="{{index .Data.Settings "site_url"}}"
                           disabled
                           class="block w-full rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-500 shadow-sm cursor-not-allowed"
                           placeholder="https://example.com">
                    <p class="mt-1 text-xs text-gray-400">Coming soon â€” site URL configuration is not yet available.</p>
                </div>

                <!-- Posts Per Page -->
                <div>
                    <label for="posts_per_page" class="block text-sm font-medium text-gray-700 mb-1">Posts per Page</label>
                    <input type="number" id="posts_per_page" name="posts_per_page"
                           value="{{index .Data.Settings "posts_per_page"}}"
                           min="1" max="100"
                           class="block w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm
                                  focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none"
                           placeholder="10">
                    <p class="mt-1 text-xs text-gray-400">Number of posts shown per page on the public site.</p>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 pt-4 border-t border-gray-100">
                <!-- Timezone -->
                <div>
                    <label for="timezone" class="block text-sm font-medium text-gray-700 mb-1">Timezone</label>
                    <select id="timezone" name="timezone"
                            class="block w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm
                                   focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none">
                        {{$tz := index .Data.Settings "timezone"}}
                        <optgroup label="Common">
                            <option value="UTC" {{if eq $tz "UTC"}}selected{{end}}>UTC</option>
                            <option value="America/New_York" {{if eq $tz "America/New_York"}}selected{{end}}>Eastern Time (US)</option>
                            <option value="America/Chicago" {{if eq $tz "America/Chicago"}}selected{{end}}>Central Time (US)</option>
                            <option value="America/Denver" {{if eq $tz "America/Denver"}}selected{{end}}>Mountain Time (US)</option>
                            <option value="America/Los_Angeles" {{if eq $tz "America/Los_Angeles"}}selected{{end}}>Pacific Time (US)</option>
                        </optgroup>
                        <optgroup label="Europe">
                            <option value="Europe/London" {{if eq $tz "Europe/London"}}selected{{end}}>London (GMT/BST)</option>
                            <option value="Europe/Paris" {{if eq $tz "Europe/Paris"}}selected{{end}}>Paris (CET/CEST)</option>
                            <option value="Europe/Berlin" {{if eq $tz "Europe/Berlin"}}selected{{end}}>Berlin (CET/CEST)</option>
                            <option value="Europe/Bucharest" {{if eq $tz "Europe/Bucharest"}}selected{{end}}>Bucharest (EET/EEST)</option>
                            <option value="Europe/Madrid" {{if eq $tz "Europe/Madrid"}}selected{{end}}>Madrid (CET/CEST)</option>
                            <option value="Europe/Rome" {{if eq $tz "Europe/Rome"}}selected{{end}}>Rome (CET/CEST)</option>
                            <option value="Europe/Amsterdam" {{if eq $tz "Europe/Amsterdam"}}selected{{end}}>Amsterdam (CET/CEST)</option>
                            <option value="Europe/Stockholm" {{if eq $tz "Europe/Stockholm"}}selected{{end}}>Stockholm (CET/CEST)</option>
                            <option value="Europe/Helsinki" {{if eq $tz "Europe/Helsinki"}}selected{{end}}>Helsinki (EET/EEST)</option>
                            <option value="Europe/Moscow" {{if eq $tz "Europe/Moscow"}}selected{{end}}>Moscow (MSK)</option>
                        </optgroup>
                        <optgroup label="Asia & Pacific">
                            <option value="Asia/Tokyo" {{if eq $tz "Asia/Tokyo"}}selected{{end}}>Tokyo (JST)</option>
                            <option value="Asia/Shanghai" {{if eq $tz "Asia/Shanghai"}}selected{{end}}>Shanghai (CST)</option>
                            <option value="Asia/Kolkata" {{if eq $tz "Asia/Kolkata"}}selected{{end}}>Kolkata (IST)</option>
                            <option value="Asia/Dubai" {{if eq $tz "Asia/Dubai"}}selected{{end}}>Dubai (GST)</option>
                            <option value="Asia/Singapore" {{if eq $tz "Asia/Singapore"}}selected{{end}}>Singapore (SGT)</option>
                            <option value="Asia/Seoul" {{if eq $tz "Asia/Seoul"}}selected{{end}}>Seoul (KST)</option>
                            <option value="Australia/Sydney" {{if eq $tz "Australia/Sydney"}}selected{{end}}>Sydney (AEST)</option>
                            <option value="Pacific/Auckland" {{if eq $tz "Pacific/Auckland"}}selected{{end}}>Auckland (NZST)</option>
                        </optgroup>
                        <optgroup label="Americas">
                            <option value="America/Toronto" {{if eq $tz "America/Toronto"}}selected{{end}}>Toronto (ET)</option>
                            <option value="America/Vancouver" {{if eq $tz "America/Vancouver"}}selected{{end}}>Vancouver (PT)</option>
                            <option value="America/Sao_Paulo" {{if eq $tz "America/Sao_Paulo"}}selected{{end}}>Sao Paulo (BRT)</option>
                            <option value="America/Mexico_City" {{if eq $tz "America/Mexico_City"}}selected{{end}}>Mexico City (CST)</option>
                            <option value="America/Argentina/Buenos_Aires" {{if eq $tz "America/Argentina/Buenos_Aires"}}selected{{end}}>Buenos Aires (ART)</option>
                        </optgroup>
                    </select>
                    <p class="mt-1 text-xs text-gray-400">Used for displaying dates and scheduling.</p>
                </div>

                <!-- Language -->
                <div>
                    <label for="language" class="block text-sm font-medium text-gray-700 mb-1">Language</label>
                    <select id="language" name="language"
                            class="block w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm
                                   focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none">
                        {{$lang := index .Data.Settings "language"}}
                        <option value="en" {{if eq $lang "en"}}selected{{end}}>English</option>
                        <option value="es" {{if eq $lang "es"}}selected{{end}}>Spanish</option>
                        <option value="fr" {{if eq $lang "fr"}}selected{{end}}>French</option>
                        <option value="de" {{if eq $lang "de"}}selected{{end}}>German</option>
                        <option value="it" {{if eq $lang "it"}}selected{{end}}>Italian</option>
                        <option value="pt" {{if eq $lang "pt"}}selected{{end}}>Portuguese</option>
                        <option value="nl" {{if eq $lang "nl"}}selected{{end}}>Dutch</option>
                        <option value="ro" {{if eq $lang "ro"}}selected{{end}}>Romanian</option>
                        <option value="pl" {{if eq $lang "pl"}}selected{{end}}>Polish</option>
                        <option value="sv" {{if eq $lang "sv"}}selected{{end}}>Swedish</option>
                        <option value="ja" {{if eq $lang "ja"}}selected{{end}}>Japanese</option>
                        <option value="ko" {{if eq $lang "ko"}}selected{{end}}>Korean</option>
                        <option value="zh" {{if eq $lang "zh"}}selected{{end}}>Chinese</option>
                        <option value="ar" {{if eq $lang "ar"}}selected{{end}}>Arabic</option>
                        <option value="hi" {{if eq $lang "hi"}}selected{{end}}>Hindi</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-400">Sets the <code>lang</code> attribute on public pages.</p>
                </div>

                <!-- Date Format -->
                <div>
                    <label for="date_format" class="block text-sm font-medium text-gray-700 mb-1">Date Format</label>
                    <select id="date_format" name="date_format"
                            class="block w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm
                                   focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none">
                        {{$df := index .Data.Settings "date_format"}}
                        <option value="2006-01-02" {{if eq $df "2006-01-02"}}selected{{end}}>2026-02-25 (ISO)</option>
                        <option value="Jan 02, 2006" {{if eq $df "Jan 02, 2006"}}selected{{end}}>Feb 25, 2026</option>
                        <option value="02 Jan 2006" {{if eq $df "02 Jan 2006"}}selected{{end}}>25 Feb 2026</option>
                        <option value="01/02/2006" {{if eq $df "01/02/2006"}}selected{{end}}>02/25/2026 (US)</option>
                        <option value="02/01/2006" {{if eq $df "02/01/2006"}}selected{{end}}>25/02/2026 (EU)</option>
                        <option value="January 2, 2006" {{if eq $df "January 2, 2006"}}selected{{end}}>February 25, 2026</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-400">How dates are displayed on the public site.</p>
                </div>
            </div>

            <!-- Save button -->
            <div class="flex justify-end pt-4 border-t border-gray-100">
                <button type="submit"
                        class="rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-500 transition-colors">
                    Save Settings
                </button>
            </div>
        </form>

        <!-- AI Provider settings -->
        <div class="p-6">
            <h3 class="text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4">AI Provider</h3>
            <p class="text-sm text-gray-500 mb-4">
                Select which AI service to use for content generation and template design.
                API keys are loaded from environment variables. Only providers with valid keys can be activated.
            </p>

            <div id="ai-provider-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                {{range .Data.Providers}}
                <div class="rounded-lg border p-4 {{if .Active}}border-indigo-300 bg-indigo-50{{else if .HasKey}}border-gray-200 bg-white hover:border-gray-300{{else}}border-gray-200 bg-gray-50 opacity-60{{end}}">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-900">{{.Label}}</span>
                        {{if .Active}}
                        <span class="inline-flex items-center rounded-full bg-indigo-100 px-2 py-0.5 text-xs font-medium text-indigo-700">Active</span>
                        {{else if .HasKey}}
                        <span class="inline-flex items-center rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-700">Available</span>
                        {{else}}
                        <span class="inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-500">No key</span>
                        {{end}}
                    </div>
                    <p class="text-xs text-gray-500 mb-1">Model: <code class="text-gray-700">{{.Model}}</code></p>
                    <p class="text-xs text-gray-400 mb-3">Key var: <code>{{.KeyEnvVar}}</code></p>
                    {{if .Active}}
                    <span class="inline-flex items-center gap-1 text-xs text-indigo-600">
                        <svg class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                        </svg>
                        Currently active
                    </span>
                    {{else if .HasKey}}
                    <form method="POST" action="/admin/ai/set-provider"
                          hx-post="/admin/ai/set-provider"
                          hx-target="#main-content"
                          hx-push-url="/admin/settings">
                        <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                        <input type="hidden" name="provider" value="{{.Name}}">
                        <button type="submit"
                                class="rounded-md bg-white border border-gray-300 px-3 py-1.5 text-xs font-medium text-gray-700 shadow-sm hover:bg-gray-50 transition-colors">
                            Activate
                        </button>
                    </form>
                    {{else}}
                    <p class="text-xs text-gray-400 italic">Set <code>{{.KeyEnvVar}}</code> to enable</p>
                    {{end}}
                </div>
                {{end}}
            </div>

            <p class="mt-4 text-xs text-gray-400">
                The active provider is used for all AI content generation and assistant features.
                Image generation always uses OpenAI DALL-E regardless of the active text provider.
            </p>
        </div>
    </div>
</div>
{{end}}
